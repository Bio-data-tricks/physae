

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Guide complet des modèles et des flux PhysAE &mdash; Documentation PhysAE </title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=d1a510d7"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/translations.js?v=e6b791cb"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Hyperparamètres et réglages" href="hyperparameters.html" />
    <link rel="prev" title="Tutoriel complet" href="tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PhysAE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guide utilisateur</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Premiers pas</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutoriel complet</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Guide complet des modèles et des flux PhysAE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#apercu-general">Aperçu général</a></li>
<li class="toctree-l2"><a class="reference internal" href="#architecture-de-reference">Architecture de référence</a></li>
<li class="toctree-l2"><a class="reference internal" href="#correspondance-des-hyperparametres">Correspondance des hyperparamètres</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recettes-pratiques">Recettes pratiques</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#amplification-du-bruit-instrument">Amplification du bruit instrument</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adaptation-a-de-nouveaux-gaz">Adaptation à de nouveaux gaz</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transfert-sur-spectrometre-reel">Transfert sur spectromètre réel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#flux-jupyter-prets-a-l-emploi">Flux Jupyter prêts à l’emploi</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gabarits-de-soumission">Gabarits de soumission</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aller-plus-loin">Aller plus loin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hyperparameters.html">Hyperparamètres et réglages</a></li>
<li class="toctree-l1"><a class="reference internal" href="gases.html">Gestion des gaz et transitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="experiments.html">Variations expérimentales</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_overview.html">Panorama des modules</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PhysAE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Guide complet des modèles et des flux PhysAE</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/model_playbook.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="guide-complet-des-modeles-et-des-flux-physae">
<h1>Guide complet des modèles et des flux PhysAE<a class="headerlink" href="#guide-complet-des-modeles-et-des-flux-physae" title="Lien vers cette rubrique"></a></h1>
<nav class="contents local" id="sommaire">
<ul class="simple">
<li><p><a class="reference internal" href="#apercu-general" id="id2">Aperçu général</a></p></li>
<li><p><a class="reference internal" href="#architecture-de-reference" id="id3">Architecture de référence</a></p></li>
<li><p><a class="reference internal" href="#correspondance-des-hyperparametres" id="id4">Correspondance des hyperparamètres</a></p></li>
<li><p><a class="reference internal" href="#recettes-pratiques" id="id5">Recettes pratiques</a></p>
<ul>
<li><p><a class="reference internal" href="#amplification-du-bruit-instrument" id="id6">Amplification du bruit instrument</a></p></li>
<li><p><a class="reference internal" href="#adaptation-a-de-nouveaux-gaz" id="id7">Adaptation à de nouveaux gaz</a></p></li>
<li><p><a class="reference internal" href="#transfert-sur-spectrometre-reel" id="id8">Transfert sur spectromètre réel</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#flux-jupyter-prets-a-l-emploi" id="id9">Flux Jupyter prêts à l’emploi</a></p></li>
<li><p><a class="reference internal" href="#gabarits-de-soumission" id="id10">Gabarits de soumission</a></p></li>
<li><p><a class="reference internal" href="#aller-plus-loin" id="id11">Aller plus loin</a></p></li>
</ul>
</nav>
<section id="apercu-general">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Aperçu général</a><a class="headerlink" href="#apercu-general" title="Lien vers cette rubrique"></a></h2>
<p>Ce guide synthétise tous les éléments nécessaires pour entraîner, adapter et
exploiter les autoencodeurs physiques fournis par <strong>PhysAE</strong>. Il complète les
pages <a class="reference internal" href="hyperparameters.html"><span class="doc">Hyperparamètres et réglages</span></a> et <a class="reference internal" href="tutorial.html"><span class="doc">Tutoriel complet</span></a> en détaillant :</p>
<ul class="simple">
<li><p>l’architecture des modèles (encodeur, têtes, raffineur) et les variantes
disponibles ;</p></li>
<li><p>la liste hiérarchisée des hyperparamètres et leurs liens avec les fichiers
YAML ;</p></li>
<li><p>plusieurs recettes pratiques pour ajuster les flux d’entraînement en fonction
de contraintes réelles (bruit accru, gaz supplémentaires, transfert) ;</p></li>
<li><p>des exemples Jupyter autoportants couvrant entraînement, optimisation Optuna
et génération de fichiers de soumission.</p></li>
</ul>
</section>
<section id="architecture-de-reference">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Architecture de référence</a><a class="headerlink" href="#architecture-de-reference" title="Lien vers cette rubrique"></a></h2>
<p>Les modules sont définis dans <code class="xref py py-mod docutils literal notranslate"><span class="pre">physae.model</span></code> et
<code class="xref py py-mod docutils literal notranslate"><span class="pre">physae.models.backbone</span></code>. Un modèle complet associe trois blocs
principaux :</p>
<ol class="arabic simple">
<li><p><strong>Encodeur spectral</strong> – extrait une représentation 1D compacte à partir des
spectres bruités. Les constructeurs enregistrés via
<code class="xref py py-func docutils literal notranslate"><span class="pre">physae.models.register_encoder()</span></code> incluent <code class="docutils literal notranslate"><span class="pre">efficientnet</span></code> (base),
<code class="docutils literal notranslate"><span class="pre">efficientnet_large</span></code> (capacité accrue), <code class="docutils literal notranslate"><span class="pre">efficientnet_v2</span></code> et
<code class="docutils literal notranslate"><span class="pre">convnext</span></code>. Chaque encodeur doit exposer un attribut <code class="docutils literal notranslate"><span class="pre">feat_dim</span></code>
renseignant la dimension de la représentation.</p></li>
<li><p><strong>Tête partagée + sorties</strong> – le <cite>shared head</cite> projette les caractéristiques
vers un espace latent (<code class="docutils literal notranslate"><span class="pre">shared_head_hidden_scale</span></code> contrôle sa taille)
avant d’alimenter soit une unique couche linéaire multi-sorties
(<code class="docutils literal notranslate"><span class="pre">head_mode:</span> <span class="pre">single</span></code>) soit un dictionnaire de têtes indépendantes
(<code class="docutils literal notranslate"><span class="pre">head_mode:</span> <span class="pre">multi</span></code>). Les paramètres à prédire sont spécifiés via
<code class="docutils literal notranslate"><span class="pre">predict_list</span></code> dans les fichiers YAML.</p></li>
<li><p><strong>Raffineur itératif</strong> – optionnel, il opère dans l’espace des paramètres
physiques pour réduire les écarts résiduels entre la reconstruction et les
spectres cibles. Les variantes suivent le même mécanisme de registre que
l’encodeur (<code class="xref py py-func docutils literal notranslate"><span class="pre">physae.models.register_refiner()</span></code>). Le nombre d’itérations
et l’échelle des mises à jour sont contrôlés par <code class="docutils literal notranslate"><span class="pre">refine_steps</span></code> et
<code class="docutils literal notranslate"><span class="pre">refine_delta_scale</span></code>.</p></li>
</ol>
<p>Le module <code class="xref py py-class docutils literal notranslate"><span class="pre">physae.model.PhysicallyInformedAE</span></code> orchestre ces composants,
assure les passages au modèle physique différentiable
(<code class="xref py py-func docutils literal notranslate"><span class="pre">physae.physics.batch_physics_forward_multimol_vgrid()</span></code>) et gère la
perte combinée reconstruction/paramètres (<code class="xref py py-class docutils literal notranslate"><span class="pre">physae.losses.ReLoBRaLoLoss</span></code>).</p>
</section>
<section id="correspondance-des-hyperparametres">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Correspondance des hyperparamètres</a><a class="headerlink" href="#correspondance-des-hyperparametres" title="Lien vers cette rubrique"></a></h2>
<p>Le tableau suivant résume les hyperparamètres les plus utilisés, la section YAML
associée et l’attribut Python concerné.</p>
<p>Les hyperparamètres détaillés (bornes, conseils d’exploration) sont décrits dans
<a class="reference internal" href="hyperparameters.html"><span class="doc">Hyperparamètres et réglages</span></a>. Ce guide fournit en plus des <strong>recettes thématiques</strong>
ci-dessous.</p>
</section>
<section id="recettes-pratiques">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Recettes pratiques</a><a class="headerlink" href="#recettes-pratiques" title="Lien vers cette rubrique"></a></h2>
<section id="amplification-du-bruit-instrument">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Amplification du bruit instrument</a><a class="headerlink" href="#amplification-du-bruit-instrument" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Activez <code class="docutils literal notranslate"><span class="pre">noise.train.p_drift</span> <span class="pre">=</span> <span class="pre">0.3</span></code> et augmentez <code class="docutils literal notranslate"><span class="pre">fringe_amp_range</span></code> pour
simuler des dérives fortes.</p></li>
<li><p>Réduisez <code class="docutils literal notranslate"><span class="pre">refine_delta_scale</span></code> à <code class="docutils literal notranslate"><span class="pre">0.05</span></code> dans les phases B pour éviter des
corrections instables.</p></li>
<li><p>Fixez <code class="docutils literal notranslate"><span class="pre">baseline_fix_enable:</span> <span class="pre">true</span></code> dans <code class="docutils literal notranslate"><span class="pre">stage_B1.yaml</span></code> ou <code class="docutils literal notranslate"><span class="pre">stage_B2.yaml</span></code>
afin de laisser le modèle corriger automatiquement la ligne de base.</p></li>
</ul>
</section>
<section id="adaptation-a-de-nouveaux-gaz">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Adaptation à de nouveaux gaz</a><a class="headerlink" href="#adaptation-a-de-nouveaux-gaz" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Ajoutez les paramètres ciblés (ex. <code class="docutils literal notranslate"><span class="pre">mf_CO2</span></code>) dans <code class="docutils literal notranslate"><span class="pre">train_ranges_base</span></code> et
<code class="docutils literal notranslate"><span class="pre">predict_list</span></code>.</p></li>
<li><p>Mettez à jour <code class="docutils literal notranslate"><span class="pre">poly_freq_&lt;gaz&gt;</span></code> dans les métadonnées passées au modèle via
<code class="xref py py-func docutils literal notranslate"><span class="pre">physae.factory.build_data_and_model()</span></code>.</p></li>
<li><p>Ajustez <code class="docutils literal notranslate"><span class="pre">shared_head_hidden_scale</span></code> à <code class="docutils literal notranslate"><span class="pre">0.65</span></code>–<code class="docutils literal notranslate"><span class="pre">0.8</span></code> pour supporter la
nouvelle tête.</p></li>
</ul>
</section>
<section id="transfert-sur-spectrometre-reel">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Transfert sur spectromètre réel</a><a class="headerlink" href="#transfert-sur-spectrometre-reel" title="Lien vers cette rubrique"></a></h3>
<ul class="simple">
<li><p>Entraînez d’abord un stage A court (<code class="docutils literal notranslate"><span class="pre">epochs:</span> <span class="pre">10</span></code>) sur un mélange synthétique
proche, puis geler l’encodeur (<code class="docutils literal notranslate"><span class="pre">train_base:</span> <span class="pre">false</span></code>) et n’affiner que le
raffineur avec <code class="docutils literal notranslate"><span class="pre">refiner_lr</span></code> plus élevé (<code class="docutils literal notranslate"><span class="pre">3e-5</span></code> à <code class="docutils literal notranslate"><span class="pre">1e-4</span></code>).</p></li>
<li><p>Injectez un petit jeu de spectres réels en validation en utilisant
<code class="docutils literal notranslate"><span class="pre">Dataset.from_arrays</span></code> et l’argument <code class="docutils literal notranslate"><span class="pre">external_val_loader</span></code> des fonctions de
formation personnalisées.</p></li>
</ul>
</section>
</section>
<section id="flux-jupyter-prets-a-l-emploi">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Flux Jupyter prêts à l’emploi</a><a class="headerlink" href="#flux-jupyter-prets-a-l-emploi" title="Lien vers cette rubrique"></a></h2>
<p>Trois carnets accompagnent ce guide dans le dossier <code class="xref py py-mod docutils literal notranslate"><span class="pre">notebooks/</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">01_quickstart_training.ipynb</span></code> – construction des jeux de données, lancement
d’un entraînement multi-stages condensé (epochs réduits) et sauvegarde des
checkpoints.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">02_hyperparameter_sweeps.ipynb</span></code> – configuration d’une étude Optuna,
analyse des essais et export des meilleurs hyperparamètres dans un fichier
<code class="docutils literal notranslate"><span class="pre">yaml</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">03_inference_and_submission.ipynb</span></code> – chargement d’un checkpoint, exécution
de l’inférence en lot et génération d’un fichier <code class="docutils literal notranslate"><span class="pre">CSV</span></code> conforme aux formats
de soumission présentés ci-dessous.</p></li>
</ul>
<p>Chaque carnet démarre par une cellule d’installation minimale et peut être
lancé depuis <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">lab</span></code> ou <code class="docutils literal notranslate"><span class="pre">jupyter</span> <span class="pre">notebook</span></code> après installation de
PhysAE en mode développement (<cite>pip install -e .[docs]</cite>).</p>
</section>
<section id="gabarits-de-soumission">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">Gabarits de soumission</a><a class="headerlink" href="#gabarits-de-soumission" title="Lien vers cette rubrique"></a></h2>
<p>Deux formats de soumission types sont proposés dans <code class="docutils literal notranslate"><span class="pre">docs/examples/submissions</span></code> :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">submission_nominal.csv</span></code> – pour des prédictions complètes (tous les
paramètres présents dans <code class="docutils literal notranslate"><span class="pre">predict_list</span></code>) ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">submission_partial.json</span></code> – pour des campagnes ne prédisant que certaines
grandeurs et laissant le reste vide ou nul.</p></li>
</ul>
<p>Ces fichiers sont générés automatiquement dans le carnet
<code class="docutils literal notranslate"><span class="pre">03_inference_and_submission.ipynb</span></code> mais peuvent également être téléchargés
et remplis manuellement.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Champs attendus dans les soumissions CSV</span><a class="headerlink" href="#id1" title="Lien vers ce tableau"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Colonne</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sample_id</span></code></p></td>
<td><p>Identifiant unique du spectre (correspondant à la clé <code class="docutils literal notranslate"><span class="pre">&quot;id&quot;</span></code> du
<code class="docutils literal notranslate"><span class="pre">Dataset</span></code>).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sig0</span></code> / <code class="docutils literal notranslate"><span class="pre">dsig</span></code> / <code class="docutils literal notranslate"><span class="pre">mf_CH4</span></code> / <code class="docutils literal notranslate"><span class="pre">P</span></code> / <code class="docutils literal notranslate"><span class="pre">T</span></code> / <code class="docutils literal notranslate"><span class="pre">baseline1</span></code> / <code class="docutils literal notranslate"><span class="pre">baseline2</span></code></p></td>
<td><p>Valeurs physiques dénormalisées produites par
<code class="xref py py-func docutils literal notranslate"><span class="pre">physae.normalization.unnorm_param_torch()</span></code>.</p></td>
</tr>
</tbody>
</table>
<p>Pour les soumissions <code class="docutils literal notranslate"><span class="pre">JSON</span></code>, chaque entrée suit la structure :</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;sample_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;val_0001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;sig0&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">3085.44</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;dsig&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.00153</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;mf_CH4&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">8.2e-06</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PhysAE-efficientnet&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;refine_steps&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Les scripts CLI <code class="xref py py-mod docutils literal notranslate"><span class="pre">physae.cli</span></code> et les fonctions d’évaluation prennent en
charge ces deux formats pour automatiser la publication de résultats.</p>
</section>
<section id="aller-plus-loin">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">Aller plus loin</a><a class="headerlink" href="#aller-plus-loin" title="Lien vers cette rubrique"></a></h2>
<ul class="simple">
<li><p>Chaînez les appels à <code class="xref py py-func docutils literal notranslate"><span class="pre">physae.training.train_stage_A()</span></code>,
<code class="xref py py-func docutils literal notranslate"><span class="pre">physae.training.train_stage_B1()</span></code> puis
<code class="xref py py-func docutils literal notranslate"><span class="pre">physae.training.train_stage_B2()</span></code> pour rejouer la stratégie multi-stage
standard (A → B1 → B2).</p></li>
<li><p>Adaptez le scheduler cosinus en définissant <code class="docutils literal notranslate"><span class="pre">scheduler_T_max</span></code> à la somme
des étapes pour aligner le cycle complet d’apprentissage.</p></li>
<li><p>Surveillez les métriques retournées par <code class="xref py py-func docutils literal notranslate"><span class="pre">physae.evaluation.evaluate_and_plot()</span></code>
pour détecter les biais systématiques et ajuster la pondération
<code class="docutils literal notranslate"><span class="pre">alpha_param</span></code>/<code class="docutils literal notranslate"><span class="pre">alpha_phys</span></code>.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="tutorial.html" class="btn btn-neutral float-left" title="Tutoriel complet" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="hyperparameters.html" class="btn btn-neutral float-right" title="Hyperparamètres et réglages" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2025, PhysAE contributors.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>