#!/usr/bin/env bash
#SBATCH --account="R240011"
#SBATCH --job-name="eff_train"
#SBATCH --time=10:00:00
#SBATCH --nodes=5
#SBATCH --gpus-per-node=4
#SBATCH --ntasks-per-node=4
#SBATCH --cpus-per-task=4
#SBATCH --mem=50G
#SBATCH --constraint=armgpu
#SBATCH --output=job_ptl_%J.out
#SBATCH --error=job_ptl_%J.err

# --- Environnement logiciel
romeo_load_armgpu_env
spack load python@3.13.0/gzl2pkh cuda@12.6.2
source /home/cosmic_86/envs/pytorch_arm_test/bin/activate

# --- Réglages runtime recommandés NCCL/CPU
export OMP_NUM_THREADS=${SLURM_CPUS_PER_TASK}
export MKL_NUM_THREADS=${SLURM_CPUS_PER_TASK}

srun --cpu-bind=cores \
     python -u /home/cosmic_86/CODES/scripts/10_PIAE_trainv2_effv2.py
